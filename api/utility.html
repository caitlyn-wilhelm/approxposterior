

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Utility Functions &mdash; approxposterior 0.4 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Installation" href="../install.html" />
    <link rel="prev" title="Likelihood Functions" href="likelihood.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> approxposterior
          

          
          </a>

          
            
            
              <div class="version">
                0.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Approximate Bayesian Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bayesopt.html">Bayesian Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../map.html">MAP Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/fittingALine.html">Fitting a Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/ScalingAccuracy.html">Scaling and Accuracy</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api.html">API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="approx.html">approx.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="gmmUtils.html">gmmUtils.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpUtils.html">gpUtils.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="mcmcUtils.html">mcmcUtils.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="likelihood.html">likelihood.py</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">utility.py</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#utility-py-utility-functions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">utility.py</span></code> - Utility Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citation.html">Citation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/dflemin3/approxposterior">Github</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/dflemin3/approxposterior/issues">Submit an Issue</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">approxposterior</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../api.html">API</a> &raquo;</li>
        
      <li>Utility Functions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/api/utility.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="module-approxposterior.utility">
<span id="utility-functions"></span><h1>Utility Functions<a class="headerlink" href="#module-approxposterior.utility" title="Permalink to this headline">¶</a></h1>
<div class="section" id="utility-py-utility-functions">
<h2><code class="xref py py-mod docutils literal notranslate"><span class="pre">utility.py</span></code> - Utility Functions<a class="headerlink" href="#utility-py-utility-functions" title="Permalink to this headline">¶</a></h2>
<p>Utility functions in terms of usefulness, e.g. minimizing GP utility functions
or computing KL divergences, and the GP utility functions, e.g. the bape utility.</p>
<dl class="function">
<dt id="approxposterior.utility.logsubexp">
<code class="sig-prename descclassname">approxposterior.utility.</code><code class="sig-name descname">logsubexp</code><span class="sig-paren">(</span><em class="sig-param">x1</em>, <em class="sig-param">x2</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/approxposterior/utility.html#logsubexp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#approxposterior.utility.logsubexp" title="Permalink to this definition">¶</a></dt>
<dd><p>Numerically stable way to compute log(exp(x1) - exp(x2))</p>
<p>logsubexp(x1, x2) -&gt; log(exp(x1) - exp(x2))</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x1</strong> (<em>float</em>) – </p></li>
<li><p><strong>x2</strong> (<em>float</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>logsubexp(x1, x2)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="approxposterior.utility.AGPUtility">
<code class="sig-prename descclassname">approxposterior.utility.</code><code class="sig-name descname">AGPUtility</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">y</em>, <em class="sig-param">gp</em>, <em class="sig-param">priorFn</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/approxposterior/utility.html#AGPUtility"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#approxposterior.utility.AGPUtility" title="Permalink to this definition">¶</a></dt>
<dd><p>AGP (Adaptive Gaussian Process) utility function, the entropy of the
posterior distribution. This is what you maximize to find the next x under
the AGP formalism. Note here we use the negative of the utility function so
minimizing this is the same as maximizing the actual utility function.</p>
<p>See Wang &amp; Li (2017) for derivation/explaination.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> (<em>array</em>) – parameters to evaluate</p></li>
<li><p><strong>y</strong> (<em>array</em>) – y values to condition the gp prediction on.</p></li>
<li><p><strong>gp</strong> (<em>george GP object</em>) – </p></li>
<li><p><strong>priorFn</strong> (<em>function</em>) – Function that computes lnPrior probability for a given theta.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>util</strong> – utility of theta under the gp</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="approxposterior.utility.BAPEUtility">
<code class="sig-prename descclassname">approxposterior.utility.</code><code class="sig-name descname">BAPEUtility</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">y</em>, <em class="sig-param">gp</em>, <em class="sig-param">priorFn</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/approxposterior/utility.html#BAPEUtility"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#approxposterior.utility.BAPEUtility" title="Permalink to this definition">¶</a></dt>
<dd><p>BAPE (Bayesian Active Posterior Estimation) utility function.  This is what
you maximize to find the next theta under the BAPE formalism.  Note here we
use the negative of the utility function so minimizing this is the same as
maximizing the actual utility function.  Also, we log the BAPE utility
function as the log is monotonic so the minima are equivalent.</p>
<p>See Kandasamy et al. (2015) for derivation/explaination.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> (<em>array</em>) – parameters to evaluate</p></li>
<li><p><strong>y</strong> (<em>array</em>) – y values to condition the gp prediction on.</p></li>
<li><p><strong>gp</strong> (<em>george GP object</em>) – </p></li>
<li><p><strong>priorFn</strong> (<em>function</em>) – Function that computes lnPrior probability for a given theta.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>util</strong> – utility of theta under the gp</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="approxposterior.utility.JonesUtility">
<code class="sig-prename descclassname">approxposterior.utility.</code><code class="sig-name descname">JonesUtility</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">y</em>, <em class="sig-param">gp</em>, <em class="sig-param">priorFn</em>, <em class="sig-param">zeta=0.01</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/approxposterior/utility.html#JonesUtility"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#approxposterior.utility.JonesUtility" title="Permalink to this definition">¶</a></dt>
<dd><p>Jones utility function - Expected Improvement derived in Jones et al. (1998)
EI(x) = E(max(f(theta) - f(thetaBest),0)) where f(thetaBest) is the best
value of the function so far and thetaBest is the best design point</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> (<em>array</em>) – parameters to evaluate</p></li>
<li><p><strong>y</strong> (<em>array</em>) – y values to condition the gp prediction on.</p></li>
<li><p><strong>gp</strong> (<em>george GP object</em>) – </p></li>
<li><p><strong>priorFn</strong> (<em>function</em>) – Function that computes lnPrior probability for a given theta.</p></li>
<li><p><strong>zeta</strong> (<em>float</em><em>, </em><em>optional</em>) – Exploration parameter. Larger zeta leads to more exploration. Defaults
to 0.01</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>util</strong> – utility of theta under the gp</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="approxposterior.utility.minimizeObjective">
<code class="sig-prename descclassname">approxposterior.utility.</code><code class="sig-name descname">minimizeObjective</code><span class="sig-paren">(</span><em class="sig-param">fn</em>, <em class="sig-param">y</em>, <em class="sig-param">gp</em>, <em class="sig-param">sampleFn</em>, <em class="sig-param">priorFn</em>, <em class="sig-param">nRestarts=5</em>, <em class="sig-param">method='nelder-mead'</em>, <em class="sig-param">options=None</em>, <em class="sig-param">bounds=None</em>, <em class="sig-param">theta0=None</em>, <em class="sig-param">args=None</em>, <em class="sig-param">maxIters=100</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/approxposterior/utility.html#minimizeObjective"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#approxposterior.utility.minimizeObjective" title="Permalink to this definition">¶</a></dt>
<dd><p>Minimize some arbitrary function, fn. This function is most useful when
evaluating fn requires a Gaussian process model, gp. For example, this
function can be used to find the point that minimizes a utility fn for a gp
conditioned on y, the data, and is allowed by the prior, priorFn.</p>
<p>PriorFn is required as it helps to select against points with non-finite
likelihoods, e.g. NaNs or infs.  This is required as the GP can only train
on finite values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fn</strong> (<em>function</em>) – function to minimize that expects x, y, gp as arguments aka fn looks
like fn_name(x, y, gp).  See <a href="#id1"><span class="problematic" id="id2">*</span></a>_utility functions above for examples.</p></li>
<li><p><strong>y</strong> (<em>array</em>) – y values to condition the gp prediction on.</p></li>
<li><p><strong>gp</strong> (<em>george GP object</em>) – </p></li>
<li><p><strong>sampleFn</strong> (<em>function</em>) – Function to sample initial conditions from.</p></li>
<li><p><strong>priorFn</strong> (<em>function</em>) – Function that computes lnPrior probability for a given theta.</p></li>
<li><p><strong>nMinObjRestarts</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of times to restart minimizing -utility function to select
next point to improve GP performance.  Defaults to 5.  Increase this
number of the point selection is not working well.</p></li>
<li><p><strong>method</strong> (<em>str</em><em>, </em><em>optional</em>) – scipy.optimize.minimize method.  Defaults to nelder-mead.</p></li>
<li><p><strong>options</strong> (<em>dict</em><em>, </em><em>optional</em>) – kwargs for the scipy.optimize.minimize function.  Defaults to None,
but if method == “nelder-mead”, options = {“adaptive” : True}</p></li>
<li><p><strong>theta0</strong> (<em>float/iterable</em><em>, </em><em>optional</em>) – Initial guess for optimization. Defaults to None, which draws a sample
from the prior function using sampleFn.</p></li>
<li><p><strong>args</strong> (<em>iterable</em><em>, </em><em>optional</em>) – Arguments for user-specified function that this function will minimize.
Defaults to None.</p></li>
<li><p><strong>(</strong><strong>int</strong><strong>)</strong><strong>, </strong><strong>optional</strong> (<em>maxIters</em>) – Maximum number of iterations to try restarting optimization if the
solution isn’t finite and/nor allowed by the prior function. Defaults to
100.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>thetaBest</strong> (<em>(1 x n_dims)</em>) – point that minimizes fn</p></li>
<li><p><strong>fnBest</strong> (<em>float</em>) – fn(thetaBest)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="approxposterior.utility.klNumerical">
<code class="sig-prename descclassname">approxposterior.utility.</code><code class="sig-name descname">klNumerical</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">p</em>, <em class="sig-param">q</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/approxposterior/utility.html#klNumerical"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#approxposterior.utility.klNumerical" title="Permalink to this definition">¶</a></dt>
<dd><p>Estimate the KL-Divergence between pdfs p and q via Monte Carlo intergration
using x, samples from p.</p>
<p>KL ~ 1/n * sum_{i=1,n}(log (p(x_i)/q(x_i)))</p>
<p>For our purposes, q is the current estimate of the pdf while p is the
previous estimate.  This method is the only feasible method for large
dimensions.</p>
<p>See Hershey and Olsen, “Approximating the Kullback Leibler
Divergence Between Gaussian Mixture Models” for more info</p>
<p>Note that this method can result in D_kl &lt; 0 but it’s the only method with
guaranteed convergence properties as the number of samples (len(x)) grows.
Also, this method is shown to have the lowest error, on average
(see Hershey and Olsen).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array</em>) – Samples drawn from p</p></li>
<li><p><strong>p</strong> (<em>function</em>) – Callable previous estimate of the density</p></li>
<li><p><strong>q</strong> (<em>function</em>) – Callable current estimate of the density</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>kl</strong> – KL divergence</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../install.html" class="btn btn-neutral float-right" title="Installation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="likelihood.html" class="btn btn-neutral float-left" title="Likelihood Functions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, David P. Fleming

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>